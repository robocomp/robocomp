<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>aprilTagsComp: wrapping E. Olson’s AprilTags in RoboComp &mdash; RoboComp 2.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> RoboComp
          </a>
              <div class="version">
                2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../README.html">Tutorials</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">RoboComp</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>aprilTagsComp: wrapping E. Olson’s AprilTags in RoboComp</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/code-examples/apriltags.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="apriltagscomp-wrapping-e-olson-s-apriltags-in-robocomp">
<h1>aprilTagsComp: wrapping E. Olson’s AprilTags in RoboComp<a class="headerlink" href="#apriltagscomp-wrapping-e-olson-s-apriltags-in-robocomp" title="Permalink to this headline"></a></h1>
<p>AprilTags is an augmented reality tag system developed by E. Olson at the U. of Michigan, USA. A complete explanation and related papers can be found <a class="reference external" href="http://april.eecs.umich.edu/wiki/index.php/AprilTags">here</a>. There is a C++ version written by Michael Kaes <a class="reference external" href="http://people.csail.mit.edu/kaess/apriltags/">here</a> which is the one we use.</p>
<p>April tags are AR tags designed to be easily detected by (robot) cameras. Understand them as a visual fiducial (artificial features) system that uses a 2D bar code style “tag”, allowing full 6 DOF localization of features from a single image. It is designed to encode smaller data (between 4 and 12 bits) and also these tags can be detected by the camera even at odd conditions. When the tag is seen by the camera, the algorithm computes the tag’s complete pose defining its own reference system relative to the camera (i.e Location of the tag is known with high accuracy). This reference system is defined as follows: If we look perpendicularly to a non rotated tag, The Z+ axis comes out towards us from the center of the tag plane, The X+ axis points leftwards and the Y+ axis points upwards (a left-hand reference system). The values computed by <em>apriltagsComp</em> are the translation vector from the camera to the center of the tag’s reference system, and the three Euler angles that encode the relative orientation of the tag’s reference system wrt to the camera reference system.</p>
<p>The <em>AprilTags.cdsl</em> file specifies how <em>apriltagsComp</em> has been generated and how it can be re-generated:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import &quot;/robocomp/interfaces/IDSLs/GetAprilTags.idsl&quot;;
import &quot;/robocomp/interfaces/IDSLs/AprilTags.idsl&quot;;
import &quot;/robocomp/interfaces/IDSLs/RGBD.idsl&quot;;
import &quot;/robocomp/interfaces/IDSLs/RGBDBus.idsl&quot;;
import &quot;/robocomp/interfaces/IDSLs/Camera.idsl&quot;;
Component AprilTagsComp{
    Communications{
            requires Camera, RGBDBus, RGBD;
            publishes AprilTags;
            implements GetAprilTags;
    };
    language Cpp;
};
</pre></div>
</div>
<p>This files tells us that the component requires -will be calling- three RoboComp interfaces: Camera, RGBDBus y RGBD, which are normal and depth camera’s interfaces written in RoboComp’s IDSL language. You can find those files in <em>~/robocomp/interfaces/IDSLs</em>. Also, the component will publish the data defined in the <em>AprilTags</em> interface and will implement the <em>GetAprilTags</em> interface. This means that using images provided by a component implementing the camera or RGBD interfaces, it will try to detect any tags in them and compute their 6D pose. Finally, it will publish a vector with all the tags id’s and poses to the Ice’s STORM broker, and also it will attend any direct requests (remote procedure calls) received from other components through the <em>GetAprilTags</em> interface. So it is a rather serviceable and handy component!</p>
<p>To access <strong>apriltagsComp</strong> you need to install from <em>https://github.com/robocomp</em> the repository named <em>robocomp-robolab</em>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd ~/robocomp/components
git clone https://github.com/robocomp/robocomp-robolab.git
</pre></div>
</div>
<p>Once downloaded, <em>apriltagsComp</em> can be found in:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>~/robocomp/components/robocomp-robolab/components/apriltagsComp
</pre></div>
</div>
<p>First, read the <em>INSTALL_APRILTAGS_LIB.TXT</em> file and follow instructions thereby. Once the library has been installed in /usr/local, we can proceed to compile the component:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd ~/robocomp/components/robocomp-robolab/components/apriltagsComp
cmake .
make
</pre></div>
</div>
<p>We should have a binary now:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>~/robocomp/components/robocomp-robolab/components/apriltagsComp/bin/apriltagscomp
</pre></div>
</div>
<section id="configuration-parameters">
<h2>Configuration parameters<a class="headerlink" href="#configuration-parameters" title="Permalink to this headline"></a></h2>
<p>As any other component, <em>apriltagsComp</em> needs a <em>config</em> file to start. In</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>~/robocomp/components/robocomp-robolab/components/apriltagsComp/etc/generic_config
</pre></div>
</div>
<p>you can find an example of a configuration file. We can find there the following lines:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>GetAprilTagsComp.Endpoints=tcp -p 12210                     //Port where GetAprilTags iface is served
CommonBehavior.Endpoints=tcp -p 11258                       //Not of use for the user now
CameraProxy = camera:tcp -h localhost -p 10001              //Port where a camera is located
RGBDProxy = rgbd:tcp -h localhost -p 10096                  //Port where a RGBD camera is located
RGBDBusProxy = rgbdbus:tcp -h localhost -p 10239            //Port where a bus of RGBDs is located
AprilTagsProxy = apriltags:tcp -h localhost -p 10261        //Not of use for the user
TopicManager.Proxy=IceStorm/TopicManager:default -p 9999    //Port where STROM broker is located
InnerModelPath=/home/robocomp/robocomp/files/innermodel/simpleworld.xml


InputInterface = RGBD                                       //Current input iface to be used
AprilTagsFamily = tagCodes36h11                             //Tags family. See AprilTags paper
AprilTagsSize = 0.17                                        //Tag default real size in meters
ID:0-10 = 0.17   #tag size in meters                        //Tags numbers 1-10 real size in meters
ID:11-20 = 0.17   #tag size in meters                       //Tags numbers 11-20 real size in meters
ID:21-30 = 0.17   #tag size in meters                       //Tags numbers 21-30 real size in meters
</pre></div>
</div>
<p>AprilTagsFamily is a set of tags, There are different families like 36h10,25h9,16h5 however <em>tagCodes36h11</em> is recommended. Each tag has an ID that is printed inside the surrounding square using Hamming code. Instructions to print tags and other tag families can be found <a class="reference external" href="http://april.eecs.umich.edu/wiki/index.php/AprilTags">here</a>. The algorithm needs the real size of the tag to estimate its position and orientation in space. We can give the component tags of different sizes, As long as they correspond to different ranges of IDs, as specified in the configuration file above.</p>
</section>
<section id="starting-the-component">
<h2>Starting the component<a class="headerlink" href="#starting-the-component" title="Permalink to this headline"></a></h2>
<p>To start the component we need a real camera connected to the cameraV4lComp component or the RCIS simulator started with a file that includes virtual tags, such as <em>simpleworld.xml</em>, Tutorial can be found <a class="reference internal" href="apritagstutorial.html"><span class="doc std std-doc">here</span></a>. Once RCIS is up and running, It will provide the RGBD.idsl interface (not Camera.idsl for now) at port 10096, which is what the configuration file states. To avoid changing the <em>generic_config</em> file in the repository, We can copy it to the component’s home directory, So changes will remain untouched by future git pulls:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cp ~/robocomp/components/robocomp-robolab/components/apriltagsComp
cp /etc/generic_config config
</pre></div>
</div>
<p>So, to begin we type:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd ~/robocomp/components/robocomp-robolab/components/apriltagsComp
bin/apriltagscomp --Ice.Config=config
</pre></div>
</div>
<p>If the robot’s camera is pointing towards one of the tags, You should see in the terminal lines showing the ID and pose of each visible tag.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, RoboLab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>