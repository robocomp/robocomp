<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RoboComp Integration with CoppeliaSim Using PyRep &mdash; RoboComp 2.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> RoboComp
          </a>
              <div class="version">
                2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="README.html">Tutorials</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">RoboComp</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>RoboComp Integration with CoppeliaSim Using PyRep</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/robocomp-pyrep.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="robocomp-integration-with-coppeliasim-using-pyrep">
<h1>RoboComp Integration with CoppeliaSim Using PyRep<a class="headerlink" href="#robocomp-integration-with-coppeliasim-using-pyrep" title="Permalink to this headline"></a></h1>
<p>In many situations, a more robust simulator than <em>RCIS</em> is required to leverege the power of <em>RoboComp</em> in more physically complex scenes.
Consequently, <em>RoboComp</em> needs to be integrated to more complex simulators and physics engines. The current choice for <em>RoboComp</em> is <a class="reference external" href="https://www.coppeliarobotics.com/">CoppeliaSim</a>, previously known as <strong>V-REP</strong>.</p>
<p>The standard remote <em>python</em> API of <strong>CoppeliaSim</strong> is very slow, so we opt for <a class="reference external" href="https://github.com/stepjam/PyRep">PyRep</a> which includes a fast and flexible API to connect with <strong>CoppeliaSim</strong>.</p>
<p>In this tutorial, we walk you through the setup procedure of <strong>CoppeliaSim</strong> and <strong>PyRep</strong>, along with some examples to try with <em>RoboComp</em>.</p>
<section id="coppeliasim-installation">
<h2>CoppeliaSim Installation<a class="headerlink" href="#coppeliasim-installation" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>First, download <strong>CoppeliaSim</strong> EDU version (compatible with your system) from <a class="reference external" href="https://www.coppeliarobotics.com/downloads.html">download page</a>.</p></li>
<li><p>Extract it into your prefered directory.</p></li>
<li><p>Add the following to your <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> file (changing the path) :</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">COPPELIASIM_ROOT</span><span class="o">=</span>PATH/TO/COPPELIASIM/INSTALL/DIR
<span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:<span class="nv">$COPPELIASIM_ROOT</span>
<span class="nb">export</span> <span class="nv">QT_QPA_PLATFORM_PLUGIN_PATH</span><span class="o">=</span><span class="nv">$COPPELIASIM_ROOT</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Source your <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> file :</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> ~/.bashrc
</pre></div>
</div>
</section>
<section id="pyrep-installation">
<h2>PyRep Installation<a class="headerlink" href="#pyrep-installation" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Check that you have installed <strong>libpython3-dev</strong> using apt</p></li>
<li><p>First, clone <em>master</em> branch of <strong>PyRep</strong> repo :958236</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/stepjam/PyRep.git
</pre></div>
</div>
<ul class="simple">
<li><p>Install <strong>PyRep</strong> dependencies and library <strong>LOCALLY (without sudo)</strong>:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> PyRep
pip3 install -r requirements.txt
pip3 install .
</pre></div>
</div>
<ul class="simple">
<li><p>Comment out the last two lines just added in your <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> file (changing the path) :</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">COPPELIASIM_ROOT</span><span class="o">=</span>PATH/TO/COPPELIASIM/INSTALL/DIR
<span class="c1">#export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$COPPELIASIM_ROOT</span>
<span class="c1">#export QT_QPA_PLATFORM_PLUGIN_PATH=$COPPELIASIM_ROOT</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Source your <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> file again:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> ~/.bashrc
</pre></div>
</div>
</section>
<section id="testing-your-installation">
<h2>Testing your Installation<a class="headerlink" href="#testing-your-installation" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Make sure that you start the pub/sub Ice broker by running in any terminal: rcnode &amp;</p></li>
<li><p>After completing the installation, you can make sure it’s working correctly, by trying some of the examples in <code class="docutils literal notranslate"><span class="pre">examples</span></code> folder in <strong>PyRep</strong> repo.</p></li>
<li><p>Also, you can refer to <a class="reference external" href="https://github.com/stepjam/PyRep#usage">Usage</a> section in main <code class="docutils literal notranslate"><span class="pre">README.md</span></code>, for easy and fast code snippets to get started with.</p></li>
</ul>
</section>
<section id="testing-robocomp-bridges">
<h2>Testing RoboComp Bridges<a class="headerlink" href="#testing-robocomp-bridges" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Now that everything is ready, you can start trying the currently-available <em>RoboComp</em> bridges.</p></li>
<li><p>The main <em>RoboComp</em> bridges that currently exists :</p>
<ul>
<li><p><a class="reference external" href="https://github.com/robocomp/dsr-graph/tree/development/robots_pyrep/omniPyrep">omniPyrep</a>.</p></li>
<li><p><a class="reference external" href="https://github.com/robocomp/dsr-graph/tree/development/robots_pyrep/pioneer_pyrep">pioneerPyrep</a>.</p></li>
<li><p><a class="reference external" href="https://github.com/robocomp/dsr-graph/tree/development/robots_pyrep/viriatoPyrep">viriatoPyrep</a>.</p></li>
<li><p><a class="reference external" href="https://github.com/robocomp/grasping/tree/master/components/viriatoGraspingPyrep">viriatoGraspingPyrep</a> : testbench for <em>6D object pose estimation</em> and <em>grasping</em>.</p></li>
</ul>
</li>
<li><p>Make sure to follow the instructions for each one.</p></li>
</ul>
</section>
<section id="current-known-issues">
<h2>Current Known Issues<a class="headerlink" href="#current-known-issues" title="Permalink to this headline"></a></h2>
<ul>
<li><p><strong>This application failed to start because no Qt platform plugin could be initialized :</strong></p>
<ul>
<li><p>This problem can appear when trying to start the component, due to compatibility issues with <em>Qt</em> version in <em>OpenCV</em> and <em>VREP</em>.</p></li>
<li><p>This problem is solved by installing <code class="docutils literal notranslate"><span class="pre">opencv-python-headless</span></code> :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install opencv-python-headless
</pre></div>
</div>
</li>
</ul>
</li>
<li><p><strong>“NotImplementedError: Must be overridden” exception in pyrep/objects/object.py, when running viriatoPyrep :</strong></p>
<ul>
<li><p>Comment out the following lines in <code class="docutils literal notranslate"><span class="pre">/home/xxxyour-userxxx/.local/lib/python3.6/site-packages/pyrep/objects/object.py</span></code> :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">assert_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_requested_type</span><span class="p">()</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">ObjectType</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">simGetObjectType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="p">))</span>
<span class="k">if</span> <span class="n">actual</span> <span class="o">!=</span> <span class="n">assert_type</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">WrongObjectTypeError</span><span class="p">(</span>
        <span class="s1">&#39;You requested object of type </span><span class="si">%s</span><span class="s1">, but the actual type was &#39;</span>
        <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">assert_type</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">actual</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p><strong>Error when installing Pyrep. This error might occur if you do a global installation (with sudo) since PyRep won’t find COPPELIASIM_ROOT:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ERROR: Command errored out with <span class="nb">exit</span> status <span class="m">1</span>:
command: /usr/bin/python3 -c <span class="s1">&#39;import sys, setuptools, tokenize; sys.argv[0] = &#39;</span><span class="s2">&quot;&#39;&quot;</span><span class="s1">&#39;/tmp/pip-req-build-m9qd50yj/setup.py&#39;</span><span class="s2">&quot;&#39;&quot;</span><span class="s1">&#39;; __file__=&#39;</span><span class="s2">&quot;&#39;&quot;</span><span class="s1">&#39;/tmp/pip-req-      build-m9qd50yj/setup.py&#39;</span><span class="s2">&quot;&#39;&quot;</span><span class="s1">&#39;;f=getattr(tokenize, &#39;</span><span class="s2">&quot;&#39;&quot;</span><span class="s1">&#39;open&#39;</span><span class="s2">&quot;&#39;&quot;</span><span class="s1">&#39;, open)(__file__);code=f.read().replace(&#39;</span><span class="s2">&quot;&#39;&quot;</span><span class="s1">&#39;\r\n&#39;</span><span class="s2">&quot;&#39;&quot;</span><span class="s1">&#39;, &#39;</span><span class="s2">&quot;&#39;&quot;</span><span class="s1">&#39;\n&#39;</span><span class="s2">&quot;&#39;&quot;</span><span class="s1">&#39;);f.close();exec(compile(code, __file__, &#39;</span><span class="s2">&quot;&#39;&quot;</span><span class="s1">&#39;exec&#39;</span><span class="s2">&quot;&#39;&quot;</span><span class="s1">&#39;))&#39;</span> egg_info --egg-base /tmp/pip-pip-egg-info-w48qqfxo
    cwd: /tmp/pip-req-build-m9qd50yj/
Complete output <span class="o">(</span><span class="m">7</span> lines<span class="o">)</span>:
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
 File <span class="s2">&quot;&lt;string&gt;&quot;</span>, line <span class="m">1</span>, <span class="k">in</span> &lt;module&gt;
 File <span class="s2">&quot;/tmp/pip-req-build-m9qd50yj/setup.py&quot;</span>, line <span class="m">7</span>, <span class="k">in</span> &lt;module&gt;
   import cffi_build.cffi_build as cffi_build
 File <span class="s2">&quot;/tmp/pip-req-build-m9qd50yj/cffi_build/cffi_build.py&quot;</span>, line <span class="m">9</span>, <span class="k">in</span> &lt;module&gt;
   raise RuntimeError<span class="o">(</span><span class="s1">&#39;COPPELIASIM_ROOT not defined.&#39;</span><span class="o">)</span>
RuntimeError: COPPELIASIM_ROOT not defined.
----------------------------------------
WARNING: Discarding file:///home/robolab/software/PyRep. Command errored out with <span class="nb">exit</span> status <span class="m">1</span>: python setup.py egg_info Check the logs <span class="k">for</span> full <span class="nb">command</span> output.
ERROR: Command errored out with <span class="nb">exit</span> status <span class="m">1</span>: python setup.py egg_info Check the logs <span class="k">for</span> full <span class="nb">command</span> output.
</pre></div>
</div>
</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, RoboLab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>