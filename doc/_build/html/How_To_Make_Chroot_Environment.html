<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chroot environment &mdash; RoboComp 2.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> RoboComp
          </a>
              <div class="version">
                2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="README.html">Tutorials</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">RoboComp</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Chroot environment</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/How_To_Make_Chroot_Environment.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="chroot-environment">
<h1>Chroot environment<a class="headerlink" href="#chroot-environment" title="Permalink to this headline"></a></h1>
<p>A chroot is a way of isolating applications from the rest of your computer, by putting them in a jail. This is particularly useful if you are testing an application which could potentially alter important system files, or which may be insecure.</p>
<p>A chroot is basically a special directory on your computer which prevents applications, if run from inside that directory, from accessing files outside the directory. In many ways, a chroot is like installing another operating system inside your existing operating system.</p>
<p>This manual will follow the steps specified in the <a class="reference external" href="https://help.ubuntu.com/community/BasicChroot">official page of Ubuntu</a>. And the system we will install as tutorial is Ubuntu 14.04 Trusty amd64.</p>
<section id="brief-explanation">
<h2>Brief Explanation<a class="headerlink" href="#brief-explanation" title="Permalink to this headline"></a></h2>
<p>Imagine you have your Robocomp version installed and working fine in your system (i.e. Ubuntu 14.04 amd64), but you need to upgrade a package (like ICE, OpenCV, etc) or a third-party library to a new version.</p>
<p>You don’t want to risk your well functional version of Robocomp and it’s dependencies, by removing the current version and installing the new one (this usually affects other packages and libraries), and you don’t have time enough to make a whole fresh installation in other partition or virtual machine, so the fastest solution is to create a jail containing the same distribution of your main system (Ubuntu 14.04 amd64) with chroot and test Robocomp with the new version of the library you need without touching your fine Robocomp installation.</p>
<p>Realize that creating a chrooted environment in your machine makes your system believe that your root directory (“/”) is in another place than the actual root of the system (like I explain on the wiki, the process in which you launch chroot believes that the root directory is in / while actually it is in /var/chroot/trusty_x64/, not letting you touch anything outside that directory and therefore not risking your current installation).</p>
<p>Another practical use for chroot is to test an especific program or library in a different distribution or architecture. For example, if you are working in Ubuntu 14.04 amd64 and you want to test if a library that you are using works fine in Debian Wheezy or Ubuntu 14.10 or Ubuntu 14.04 i386.</p>
</section>
<section id="creating-a-chroot">
<h2>Creating a chroot<a class="headerlink" href="#creating-a-chroot" title="Permalink to this headline"></a></h2>
<ol class="arabic">
<li><p>First of all we need to install the tools to make a chroot in out system.</p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">debootstrap</span> <span class="pre">schroot</span></code></p>
</li>
<li><p>Create a folder where the chroot is going to be installed. You need to make the folder using administrator permission (with <em>sudo</em> i.e). We will put the chroot up in <em>/var/chroot/trusty_x64</em></p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">mkdir</span> <span class="pre">/var/chroot</span> <span class="pre">&amp;&amp;</span> <span class="pre">sudo</span> <span class="pre">mkdir</span> <span class="pre">/var/chroot/trusty_x64</span></code></p>
</li>
<li><p>Create a configuration file for schroot. For our example, we will create a file named trusty_x64.conf in <em>/etc/schroot/chroot.d/</em></p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">gedit</span> <span class="pre">/etc/schroot/chroot.d/trusty_x64.conf</span></code></p>
<p>And write the following inside: (Change the <USERNAME> to actual username, example “root-users=abhi”</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>trusty_x64<span class="o">]</span>
<span class="nv">description</span><span class="o">=</span>Ubuntu trusty <span class="m">14</span>.04 <span class="k">for</span> amd64
<span class="nv">directory</span><span class="o">=</span>/var/chroot/trusty_x64
root-users<span class="o">=</span>&lt;USERNAME&gt;
<span class="nv">type</span><span class="o">=</span>directory
<span class="nv">users</span><span class="o">=</span>testuser
</pre></div>
</div>
</li>
</ol>
<ul class="simple">
<li><p>The first line is the name of the chroot thatis going to be created.</p></li>
<li><p><strong>description</strong> is a short description of the chroot.</p></li>
<li><p><strong>directory</strong> the path where the chroot is going to be installed. Note that is the same path that we specified in step 2.</p></li>
<li><p><strong>root-users</strong> list of users that are allowed in our chroot without password.</p></li>
<li><p><strong>type</strong>  The type of the chroot. Valid types are ‘plain’, ‘directory’, ‘file’, ‘block-device’ and ‘lvm-snapshot’. If empty or omitted, the default type is ‘plain’.</p></li>
<li><p><strong>users</strong> list of users that are allowed access to the chroot.</p></li>
</ul>
<p>See <a class="reference external" href="http://manpages.ubuntu.com/manpages/impish/en/man5/schroot.conf.5.html">schroot.config</a> for further information.</p>
<ol class="arabic">
<li><p>Run Debootstrap. This step will download and unpack a basic ubuntu or debian system to the chroot directory we created in step 2.</p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">debootstrap</span> <span class="pre">--variant=buildd</span> <span class="pre">--arch</span> <span class="pre">amd64</span> <span class="pre">trusty</span> <span class="pre">/var/chroot/trusty_x64</span> <span class="pre">http://archive.ubuntu.com/ubuntu</span></code></p>
<p>In our example, we are creating a chroot of an Ubuntu 14.04 64-bit distribution, but this command allows some different commands that can satisfy our needs, for instance, if we want to install the same distribution but the 32-bit version, we have to type:</p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">debootstrap</span> <span class="pre">--variant=buildd</span> <span class="pre">--arch</span> <span class="pre">i386</span> <span class="pre">trusty</span> <span class="pre">/var/chroot/trusty</span> <span class="pre">http://archive.ubuntu.com/ubuntu</span></code></p>
<p>Note that we have to do the proper changes creating a different schroot configuration file (i.e. <em>/etc/schroot/chroot.d/trusty</em>) and a different folder for the new chroot (i.e. <em>/var/chroot/trusty</em>)</p>
<p>If we want to create a chroot for a Debian version (i.e. Debian Wheezy (stable)) we have to type:</p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">debootstrap</span> <span class="pre">--variant=buildd</span> <span class="pre">--arch</span> <span class="pre">amd64</span> <span class="pre">wheezy</span> <span class="pre">/var/chroot/wheezy_x64</span> <span class="pre">http://ftp.debian.org/debian</span></code></p>
</li>
<li><p>Checking the chroot. To be sure that everything went ok, we can type the following command, that will list all the available chroot enviroments in out system.</p>
<p><code class="docutils literal notranslate"><span class="pre">schroot</span> <span class="pre">-l</span></code></p>
<p>If trusty_x64 appears, we can start working in our chrooted environment typing:</p>
<p><code class="docutils literal notranslate"><span class="pre">schroot</span> <span class="pre">-c</span> <span class="pre">trusty_x64</span> <span class="pre">-u</span> <span class="pre">root</span></code></p>
<p>The prompt of the chrooted environment should be like:</p>
<p><code class="docutils literal notranslate"><span class="pre">(trusty_x64)root&#64;abhi-Inspiron-7520:/home/abhi#</span></code></p>
<p><strong>NOTE</strong> This step is not mandatory.
<strong>NOTE</strong> For convenience, the default schroot configuration rebinds the /home directory on the host system so that it appears in the chroot system. This could be unexpected because it means that you can accidentally delete or otherwise damage things in /home on the host system. To change this behaviour we can run the following command in the host system:</p>
</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo gedit /etc/schroot/default/fstab<span class="sb">`</span>
</pre></div>
</div>
<p>And comment the /home line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># fstab: static file system information for chroots.</span>
<span class="c1"># Note that the mount point will be prefixed by the chroot path</span>
<span class="c1"># (CHROOT_PATH)</span>
<span class="c1">#</span>
<span class="c1"># &lt;file system&gt; &lt;mount point&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;</span>
/proc           /proc           none    rw,bind        <span class="m">0</span>       <span class="m">0</span>
/sys            /sys            none    rw,bind        <span class="m">0</span>       <span class="m">0</span>
/dev            /dev            none    rw,bind         <span class="m">0</span>       <span class="m">0</span>
/dev/pts        /dev/pts        none    rw,bind         <span class="m">0</span>       <span class="m">0</span>
<span class="c1">#/home          /home           none    rw,bind         0       0</span>
/tmp            /tmp            none    rw,bind         <span class="m">0</span>       <span class="m">0</span>
</pre></div>
</div>
<p>And that’s it! Now we have a whole very basic system in which you can test out programs and libraries.</p>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>If you get locale warnings in the chroot like <strong>“Locale not supported by C library.”</strong> or <strong>“perl: warning: Setting locale failed.”</strong>, then try one or more of these commands:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo dpkg-reconfigure locales
sudo apt-get install language-pack-en
sudo locale-gen en_US.UTF-8
sudo dpkg-reconfigure locales
</pre></div>
</div>
<p>If the problem persist check out this <a class="reference external" href="http://perlgeek.de/en/article/set-up-a-clean-utf8-environment">page</a>.</p>
<ul class="simple">
<li><p>To get access to the intertet within the chroot, you have to type:</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">cp</span> <span class="pre">/etc/resolv.conf</span> <span class="pre">/var/chroot/trusty_x64/etc/resolv.conf</span></code></p>
</section>
<section id="external-links">
<h2>External Links<a class="headerlink" href="#external-links" title="Permalink to this headline"></a></h2>
<p><a class="reference external" href="https://help.ubuntu.com/community/BasicChroot">Ubuntu official chroot manual</a></p>
<p><a class="reference external" href="https://help.ubuntu.com/community/DebootstrapChroot">Ubuntu official deboostrap manual</a></p>
<p><a class="reference external" href="http://perlgeek.de/en/article/set-up-a-clean-utf8-environment">PerlGeek troubleshooting</a></p>
<p><a class="reference external" href="http://manpages.ubuntu.com/manpages/impish/en/man5/schroot.conf.5.html">Schroot conf manual</a></p>
<p><a class="reference external" href="http://manpages.ubuntu.com/manpages/impish/en/man8/debootstrap.8.html">Debootstap manual</a></p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, RoboLab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>